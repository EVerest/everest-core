{
    "description": "This interface defines the board support driver for AC power path: ControlPilot, Relais, RCD and motor lock",
    "cmds": {
        "setup": {
            "description": "Setup config options",
            "arguments": {
                "three_phases": {
                    "description": "true: Three phases enabled, false: only single phase",
                    "type": "boolean"
                },
                "has_ventilation": {
                    "description": "true: Allow mode D charging, false: do not allow mode D charging",
                    "type": "boolean"
                },
                "country_code": {
                    "description": "A two-letter country code in ISO 3166-1 alpha-2 format",
                    "type": "string"
                },
                "rcd_enabled": {
                    "description": "true: enable RCD, false: disable RCD",
                    "type": "boolean"
                }
            }
        },
        "get_hw_capabilities": {
            "description": "Get Hardware capability/limits",
            "result": {
                "description": "Hardware capability/limits",
                "type": "object",
                "max_current_A": {
                    "description": "Maximum current (ampere) the hardware can handle",
                    "type": "number"
                },
                "min_current_A": {
                    "description": "Minimum current (ampere) the hardware can use to charge. Values below may be set but may result in pause instead.",
                    "type": "number"
                },
                "max_phase_count": {
                    "description": "Max nr of phases the hardware can use",
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 3
                },
                "min_phase_count": {
                    "description": "Minimum nr of phases the hardware can use",
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 3
                },
                "supports_changing_phases_during_charging": {
                    "description": "Indicates whether changing number of phases is supported during charging (true) or not (false)",
                    "type": "boolean"
                }
            }
        },
        "enable": {
            "description": "Enables or disables the EVSE. Typically disabled results in control pilot state F. It must not accept cars for new charging sessions if disabled.",
            "arguments": {
                "value": {
                    "description": "True: enabled, false: disabled.",
                    "type": "boolean"
                }
            }
        },
        "pwm_on": {
            "description": "Turns PWM on with duty cycle",
            "arguments": {
                "value": {
                    "description": "PWM duty cycle (>0, <1)",
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                }
            }
        },
        "pwm_off": {
            "description": "Turns PWM off (constant high voltage)"
        },
        "pwm_F": {
            "description": "Turns PWM off with Error F (constant negative voltage)"
        },
        "allow_power_on": {
            "description": "Sets allow_power_on flag. If false, Relais must never be switched on.",
            "arguments": {
                "value": {
                    "description": "True: allow power on, false: do not allow power on.",
                    "type": "boolean"
                }
            }
        },
        "force_unlock": {
            "description": "Force unlock motor lock",
            "result": {
                "description": "Returns true if unlocking sequence was successfully executed",
                "type": "boolean"
            }
        },
        "switch_three_phases_while_charging": {
            "description": "Special command to force switching between one and three phases while charging is active. HW must go through some special sequence to ensure safe operation.",
            "arguments": {
                "value": {
                    "description": "True: switch to 3ph, False: switch to 1ph",
                    "type": "boolean"
                }
            }
        }
    },
    "vars": {
        "event": {
            "description": "Event from ControlPilot signal/Relais/RCD",
            "type": "string",
            "enum": [
                "CarPluggedIn",
                "CarRequestedPower",
                "PowerOn",
                "PowerOff",
                "CarRequestedStopPower",
                "CarUnplugged",
                "ErrorE",
                "ErrorDF",
                "ErrorRelais",
                "ErrorRCD",
                "ErrorVentilationNotAvailable",
                "ErrorOverCurrent",
                "RestartMatching",
                "PermanentFault"
            ]
        },
        "nr_of_phases_available": {
            "description": "Instantaneous phase count available to car",
            "type": "integer",
            "minimum": 1,
            "maximum": 3
        },
        "telemetry": {
            "description": "Other telemetry",
            "type": "object",
            "properties": {
                "temperature": {
                    "description": "Current temperature of the EVSE in degree celsius",
                    "type": "number"
                },
                "fan_rpm": {
                    "description": "RPM of the fan. 0 if off or no fan available.",
                    "type": "number"
                },
                "supply_voltage_12V": {
                    "description": "Internal 12V supply voltage",
                    "type": "number"
                },
                "supply_voltage_minus_12V": {
                    "description": "Internal -12V supply voltage",
                    "type": "number"
                },
                "rcd_current": {
                    "description": "Residual current in mA",
                    "type": "number"
                },
                "relais_on": {
                    "description": "true if power to the car is currently on, false if off",
                    "type": "boolean"
                }
            },
            "additionalProperties": false
        }
    }
}
