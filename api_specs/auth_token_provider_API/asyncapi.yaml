---
asyncapi: 3.0.0
id: 'pionix:de:basecamp:auth_token_provider_API'
info:
  title: "Basecamp API definition for auth token provider"
  version: 1.0.1
  description: >-
    API for basecamp drivers implementing auth token provider.

  license:
    name: BaseCamp - License Version 1.0
    url: https://www.pionix.de/pionix-license-terms
  tags:
    - name: basecamp
    - name: Auth
servers:
  default:
    pathname: 'basecamp/api/1.0/auth_token_provider/{module_id}'
    host: 'localhost:1883'
    description: default local MQTT
    protocol: mqtt
    variables:
      module_id:
        description: The ID of the module as defined in the basecamp config file.
defaultContentType: application/json

channels:
  send_provided_token:
    address: 'm2b/provided_token'
    messages:
      provided_token:
        $ref: '#/components/messages/send_provided_token'
  send_communication_check:
    address: 'm2b/communication_check'
    messages:
      send_communication_check:
        $ref: '#/components/messages/send_communication_check'
  receive_heartbeat:
    address: 'b2m/heartbeat'
    messages:
      receive_heartbeat:
        $ref: '#/components/messages/receive_heartbeat'


operations:
  send_provided_token:
    title: Send provided token
    action: send
    channel:
      $ref: '#/channels/send_provided_token'
    description: 'Direction: Module to BaseCamp'
  send_communication_check:
    title: Send communication check
    action: send
    channel:
      $ref : '#/channels/send_communication_check'
  receive_heartbeat:
    title: Receive heatbeat
    action: receive
    channel:
      $ref: '#/channels/receive_heartbeat'


components:
  messages:
    send_provided_token:
      title: Send provided toekn
      summary: 'The provided token'
      contentType: application/json
      payload:
        $ref: '#/components/schemas/ProvidedIdToken'
      examples:
        - summary: "CommunicationCheck"
          payload:
            authorization_type: "OCPP"
            id_token:
              type: "Central"
              value: "TOKEN"
    send_communication_check:
      title: Send communication check
      summary: Signal to BaseCamp that communication is good or check shall be stopped
      contentType: application/json
      payload:
        $ref: '#/components/schemas/CommunicationCheck'
      examples:
        - summary: "CommunicationCheck"
          payload:
            true
    receive_heartbeat:
      title: Receive heartbeat
      summary: Heartbeat produced by basecamp as configured via cfg_heartbeat_interval_ms in the basecamp configuration
      contentType: application/json



  schemas:
    IdTokenType:
      description: >-
        IdTokenType of the provided token. Required by OCPP2.0.1 to distinguish between different types of tokens.
      type: string
      enum:
        - Central
        - eMAID
        - MacAddress
        - ISO14443
        - ISO15693
        - KeyCode
        - Local
        - NoAuthorization
    AuthorizationType:
      description: >-
        Type of authorization of the provided token. The value
        of AuthorizationType can influence the authorization process
      type: string
      enum:
        - OCPP
        - RFID
        - Autocharge
        - PlugAndCharge
        - BankCard

    CustomIdToken:
      description: Type for a custom id token with a free-form type
      type: object
      required:
        - value
        - type
      properties:
        value:
          description: Arbitrary value of the IdToken
          type: string
          minLength: 0
          maxLength: 36
        type:
          description: Custom type of the token
          type: string
          minLength: 0
          maxLength: 50

    IdToken:
      description: Type for an id token
      type: object
      additionalProperties: true
      required:
        - value
        - type
      properties:
        value:
          description: >-
            Arbitrary value of the IdToken: This has to be printable case insensitive ascii
          type: string
          minLength: 0
          maxLength: 36
        type:
          description: Type of the token
          type: string
          $ref: "#/components/schemas/IdTokenType"
        additional_info:
          description: A list of additional custom id tokens than can be used for providing additional information for validation
          type: array
          items:
            type: object
            $ref: "#/components/schemas/CustomIdToken"
    ProvidedIdToken:
      description: Type for IdToken provided by auth token providers. Contains additional information about the IdToken like the source and purpose
      type: object
      additionalProperties: true
      required:
        - id_token
        - authorization_type
      properties:
        request_id:
          description: >-
            Id of the authorization request of this token. Could be used to put remoteStartId of OCPP2.0.1
          type: integer
        id_token:
          description: IdToken of the provided token
          type: object
          $ref: "#/components/schemas/IdToken"
        parent_id_token:
          description: Parent IdToken of the provided token
          type: object
          $ref: "#/components/schemas/IdToken"
        authorization_type:
          description: Authorization type of the token.
          type: string
          $ref: "#/components/schemas/AuthorizationType"
          minLength: 2
          maxLength: 32
        connectors:
          description: A list of connector ids to which the authorization can be assigned
          type: array
          items:
            minimum: 1
            type: integer
        prevalidated:
          description: Indicates that the id token is already validated by the provider
          type: boolean
        certificate:
          description: The X.509 certificated presented by EV and encoded in PEM format
          type: string
          maxLength: 5500

    CommunicationCheck:
      type: boolean
      description: "Send 'true' at least every 'cfg_communication_check_to_s' seconds to signal module is alive. Send 'false' to stop communication check'"
